node {
    def appDir = '/var/www/html3/reactjs-app'
    def buildDir = 'build'

    stage('Clean Workspace') {
        echo 'Cleaning Jenkins Workspace'
        deleteDir()
    }

    stage('Clone Repo') {
        echo 'Cloning the repo'
        git(
            branch: 'master',
            url: 'https://github.com/lallanborasi12/Projet1.git'
        )
    }

    stage('Build React App') {
        echo 'Installing dependencies & building React app'
        sh """
            npm install
            npm run build
        """
    }

    stage('Deploy to Apache') {
        echo 'Deploying build folder to Apache directory'
        sh """
            sudo mkdir -p ${appDir}
            sudo chown -R jenkins:jenkins ${appDir}

            # Remove old files
            sudo rm -rf ${appDir}/*

            # Copy new build files
            sudo cp -r ${buildDir}/* ${appDir}/
        """
    }
}
